
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>Patterns - TIPS Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bc9ec4d8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9baa7069.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#implementation-patterns" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="TIPS Documentation" class="md-header__button md-logo" aria-label="TIPS Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TIPS Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Patterns
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="TIPS Documentation" class="md-nav__button md-logo" aria-label="TIPS Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    TIPS Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Workflow
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Workflow" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Workflow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Patterns
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Patterns
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#inputoutput" class="md-nav__link">
    Input/output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-parameters" class="md-nav__link">
    Default parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-and-caching" class="md-nav__link">
    Running and caching
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../abstract/" class="md-nav__link">
        Abstract
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      <label class="md-nav__link" for="__nav_3_4">
        Strategies
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Strategies" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Strategies
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../explore/" class="md-nav__link">
        tips/explore
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      <label class="md-nav__link" for="__nav_3_5">
        Implementions
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Implementions" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Implementions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tips/" class="md-nav__link">
        tips/tips
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pinn/" class="md-nav__link">
        tips/pinn
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lammps/" class="md-nav__link">
        tips/lammps
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gromacs/" class="md-nav__link">
        tips/gromacs
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      <label class="md-nav__link" for="__nav_3_6">
        Development
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Development" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../develop_env/" class="md-nav__link">
        Environment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../custom_process/" class="md-nav__link">
        Custom process
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        CLI
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="CLI" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          CLI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      <label class="md-nav__link" for="__nav_4_2">
        Commands
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Commands" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Commands
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/convert/" class="md-nav__link">
        convert
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/filter/" class="md-nav__link">
        filter
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/formats/" class="md-nav__link">
        File formats
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="implementation-patterns">Implementation patterns</h1>
<p>The TIPS workflows are implemented in <a href="https://www.nextflow.io/">Nextflow</a>, if
you are interested in using TIPS, it would be good if you are familiar with
basic concepts in Nextflow such are data channels, <code>params</code>, and basic options 
like running and importing workflows.</p>
<p>This document explains the patterns that TIPS follows in implementing AML
workflows. A typical process in TIPS looks like this:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#!/usr/bin/env nextflow</span>
<span class="n">nextflow</span><span class="o">.</span><span class="na">enable</span><span class="o">.</span><span class="na">dsl</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">params</span><span class="o">.</span><span class="na">publishDir</span>   <span class="o">=</span> <span class="s1">&#39;myoutput&#39;</span>
<span class="n">params</span><span class="o">.</span><span class="na">publishMode</span>  <span class="o">=</span> <span class="s1">&#39;link&#39;</span>
<span class="n">include</span> <span class="o">{</span><span class="n">getParams</span><span class="o">}</span> <span class="n">from</span> <span class="s1">&#39;./tips/utils&#39;</span>
<span class="n">defaults</span>            <span class="o">=</span> <span class="o">[:]</span>
<span class="n">defaults</span><span class="o">.</span><span class="na">inp</span>        <span class="o">=</span> <span class="kc">null</span>
<span class="n">defaults</span><span class="o">.</span><span class="na">ds</span>         <span class="o">=</span> <span class="kc">null</span>
<span class="n">defaults</span><span class="o">.</span><span class="na">myParam</span>    <span class="o">=</span> <span class="s1">&#39;myParam&#39;</span>
<span class="n">defaults</span> <span class="o">=</span> <span class="n">getParams</span><span class="o">(</span><span class="n">defaults</span><span class="o">,</span> <span class="n">params</span><span class="o">)</span>
<span class="n">process</span> <span class="n">myworkflow</span> <span class="o">{</span>
    <span class="n">publishDir</span> <span class="o">{</span><span class="s2">&quot;$params.publishDir&quot;</span><span class="o">},</span> <span class="nl">mode:</span> <span class="n">params</span><span class="o">.</span><span class="na">publishMode</span>
    <span class="nl">input:</span> <span class="n">tuple</span> <span class="n">val</span><span class="o">(</span><span class="n">meta</span><span class="o">),</span> <span class="n">val</span><span class="o">(</span><span class="n">input</span><span class="o">)</span>
    <span class="nl">output:</span> <span class="n">tuple</span> <span class="n">val</span><span class="o">{</span><span class="n">meta</span><span class="o">},</span> <span class="n">file</span><span class="o">(</span><span class="s2">&quot;output.xyz&quot;</span><span class="o">)</span> 
    <span class="nl">script:</span>
    <span class="n">setup</span> <span class="o">=</span> <span class="n">getParams</span><span class="o">(</span><span class="n">defaults</span><span class="o">,</span> <span class="n">inputs</span><span class="o">)</span>
    <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    my_code $setup.ds $setup.input $setup.myParam &gt; output.xyz</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="o">}</span>

<span class="n">workflow</span> <span class="o">{</span><span class="n">labeller</span><span class="o">([</span><span class="kc">null</span><span class="o">,</span> <span class="o">[:]])}</span>
</code></pre></div>
</td></tr></table>
<h2 id="inputoutput">Input/output</h2>
<p>As mentioned in the <a href="../overview/#inclusion">overview</a>, all workflows in TIPS has
two inputs, a meta data and a "real" input. When the workflow is included as a
sub-workflow, the metadata will be set to identify the result (e.g. in
<code>tips/explore</code> this includes the iteration and random seed for each model.)</p>
<p>More specifically, the <code>inputs</code> should be a Groovy map (dictionary) that
contains all the options required to run a process. The reason of using a single
map for all inputs it to allow the same process to be used with different types 
of input channels.</p>
<h2 id="default-parameters">Default parameters</h2>
<p>The defaults variable holds all the variables that may be updated by <code>inputs</code>,
and their default values.You might notice that in L11 and L16, the
<code>getParams(source, updates)</code> are used twice to update the defaults, first with
the <code>params</code> and then with the <code>inputs</code>. This means the inputs to your process
can be specified with CLI options and the data channel. After the updates, the
<code>setup</code> variable should be used in the script.</p>
<h2 id="running-and-caching">Running and caching</h2>
<p>The example module provides a default workflow that invokes the process with an
empty map. This allows you to run the workflow as:</p>
<div class="highlight"><pre><span></span><code>$ nf run mymodule.nf --inp inp_file --ds ds_file
</code></pre></div>
<p>Alternatively, within a wokflow:
<div class="highlight"><pre><span></span><code><span class="n">include</span> <span class="o">{</span><span class="n">myworkflow</span><span class="o">}</span> <span class="n">from</span> <span class="n">mymodule</span>
<span class="n">myworkflow</span><span class="o">([</span><span class="nl">inp:</span> <span class="s1">&#39;input_file&#39;</span><span class="o">,</span> <span class="nl">ds:</span> <span class="s1">&#39;ds_file&#39;</span><span class="o">])</span>
</code></pre></div></p>
<p>The difference between the two ways is that in the later case the variables will
be considered as inputs by Nextflow, and used to compute the <a href="https://www.nextflow.io/docs/latest/process.html#cache">cache
keys</a>.</p>
<p>This should not cause a big difference if your input in used in the script.
However, if you have some variable that does not change the outcome of the
workflow (e.g. the publish options here), you might want to exclude it from you
defaults map and only put it as a key of <code>params</code> (so that you can use the
<code>-resume</code> option after changing <code>publishDir</code>).</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../overview/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Overview
            </div>
          </div>
        </a>
      
      
        <a href="../abstract/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Abstract
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
    
  </body>
</html>