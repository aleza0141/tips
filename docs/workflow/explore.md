#  `explore.nf`

`explore.nf` is an workflow in which a model is used to sample the configuration
space.

``` mermaid
graph LR
  A[initDs] --> B([trainer]);
  B --> C[model];
  C --> D([sampler]);
  D --> E{{tol?}} 
  E -- yes --> F[finalModel];
  E -- no --> G[augDs];
  G --> B;
```

This workflow outputs the final model for each input.

## Available

| Inputs       | Default  | Description                      |
|--------------|----------|----------------------------------|
| trainer      | "pinn"   | an abstract trainer              |
| sampler      | "pinn"   | an abstract sampler              |
| labeller     | "lammps" | an abstract labeller             |
| maxIter      | 10       | max iteration                    |
| initDs       | null     | initial dataset                  |
| trainInit    | null     | initial input for trainer        |
| trainParam   | null     | extra params for trainer         |
| trainSeeds   | 3        | number of seeds for qbc          |
| trainSteps   | 200000   | initial training steps           |
| retrainIter  | 200000   | retrain steps after augmentation |
| sampleInit   | null     | initial structure for sampler    |
| sampleParams | null     | extra params for sampler         |
| labelInp     | null     | input for labbeller              |


## Example usage

`explore.nf` assumes that we have already a minimal dataset to start with, this
might not be always the case. Below show an example of training a model with the
SPC/Fw classical force field, where an initial dataset is generated by the same
force field with a short NVT simulation (the files to reproduce this workflow
can be found [here](https://github.com/yqshao/tips/tree/master/demo/explore))

```groovy
#!/usr/bin/env nextflow
nextflow.enable.dsl=2

geometry = 'input.geo'
trainInp = 'pinet.yml'
labelInp = [inp:'spcefw_label.lmp', init:geometry]
sampleInp = [inp:'spcefw_nvt.lmp', init:geometry]

include {explore} from './tips/explore', addParams(trainInp:trainInp, labelInp:labelInp)
include {sampler} from './tips/adaptor', addParams(sampler:'lammps')

workflow {
    initDs = sampler([null, [inp:sampleInp, init:geometry]]))
    inputs = initDs.map{[it[0], [iniDs:it[1]]]}
    explore(inputs)
}
```

Here, the training and labelling configs are parsed to the explorer through
`params`.
